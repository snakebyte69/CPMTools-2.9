Content-type: text/html

<HTML><HEAD><TITLE>Manpage of CPM</TITLE>
</HEAD><BODY>
<H1>CPM</H1>
Section: File formats (5)<BR>Updated: November 20, 2009<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME cpm - CP/M disk and file system format</H2>


<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION <A NAME="lbAE">&nbsp;</A>
<H3>Characteristic sizes Each CP/M disk format is described by the following specific sizes:</H3>

</H2>

<DL COMPACT><DT><DD>
<P>
Sector size in bytes
<BR>

Number of tracks
<BR>

Number of sectors
<BR>

Block size
<BR>

Number of directory entries
<BR>

Logical sector skew
<BR>

Number of reserved system tracks
<P>
</DL>

A block is the smallest allocatable storage unit.  CP/M supports block
sizes of 1024, 2048, 4096, 8192 and 16384 bytes.  Unfortunately, this
format specification is not stored on the disk and there are lots of
formats.  Accessing a block is performed by accessing its sectors, which
are stored with the given software skew.

<A NAME="lbAF">&nbsp;</A>
<H3>Device areas A CP/M disk contains three areas:</H3>

<DL COMPACT><DT><DD>
<P>
System tracks (optional)
<BR>

Directory
<BR>

Data
<P>
</DL>

The system tracks store the boot loader and CP/M itself.  In order to save
disk space, there are non-bootable formats which omit those system tracks.
The term <I>disk capacity</I> always excludes the space for system tracks.
Note that there is no bitmap or list for free blocks.  When accessing a
drive for the first time, CP/M builds this bitmap in core from the directory.

<A NAME="lbAG">&nbsp;</A>
<H3>Directory entries The directory is a sequence of directory entries (also called extents),</H3>

which contain 32 bytes of the following structure:
<DL COMPACT><DT><DD>
<P>


St<TT>&nbsp;</TT>F0<TT>&nbsp;</TT>F1<TT>&nbsp;</TT>F2<TT>&nbsp;</TT>F3<TT>&nbsp;</TT>F4<TT>&nbsp;</TT>F5<TT>&nbsp;</TT>F6<TT>&nbsp;</TT>F7<TT>&nbsp;</TT>E0<TT>&nbsp;</TT>E1<TT>&nbsp;</TT>E2<TT>&nbsp;</TT>Xl<TT>&nbsp;</TT>Bc<TT>&nbsp;</TT>Xh<TT>&nbsp;</TT>Rc<BR>
<BR>

Al<TT>&nbsp;&nbsp;&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>Al<TT>&nbsp;</TT>AlAl<BR>
<P>
</DL>


<B>St</B> is the status; possible values are:
<DL COMPACT><DT><DD>
<P>
0-15: used for file, status is the user number
<BR>

16-31: used for file, status is the user number (P2DOS)
or used for password extent (CP/M 3 or higher)
<BR>

32: disc label
<BR>

33: time stamp (P2DOS)
<BR>

0xE5: unused
<P>
</DL>


<P>


<B>F0-E2</B> are the file name and its extension.  They may consist of
any printable 7 bit ASCII character but: <B>&lt; &gt; . , ; : = ? * [ ]</B>.
The file name must not be empty, the extension may be empty.  Both are
padded with blanks.  The highest bit of each character of the file name
and extension is used as attribute.  The attributes have the following
meaning:
<DL COMPACT><DT><DD>
<P>
F0: requires set wheel byte (Backgrounder II)
<BR>

F1: public file (P2DOS, ZSDOS), forground-only command (Backgrounder II)
<BR>

F2: date stamp (ZSDOS), background-only commands (Backgrounder II)
<BR>

F7: wheel protect (ZSDOS)
<BR>

E0: read-only
<BR>

E1: system file
<BR>

E2: archived
<P>
</DL>

Public files (visible under each user number) are not supported by CP/M
2.2, but there is a patch and some free CP/M clones support them without
any patches.
<P>

The wheel byte is (by default) the memory location at 0x4b.  If it is
zero, only non-privileged commands may be executed.

<P>


<B>Xl</B> and <B>Xh</B> store the extent number.  A file may use more than
one directory entry, if it contains more blocks than an extent can hold.
In this case, more extents are allocated and each of them is numbered
sequentially with an extent number.  If a physical extent stores more than
16k, it is considered to contain multiple logical extents, each pointing
to 16k data, and the extent number of the last used logical extent
is stored.  Note: Some formats decided to always store only one logical
extent in a physical extent, thus wasting extent space.  CP/M 2.2 allows
512 extents per file, CP/M 3 and higher allow up to 2048.  Bit 5-7 of
Xl are 0, bit 0-4 store the lower bits of the extent number.  Bit 6
and 7 of Xh are 0, bit 0-5 store the higher bits of the extent number.

<P>


<B>Rc</B> and <B>Bc</B> determine the length of the data used by this extent.  The
physical extent is divided into logical extents, each of them being 16k
in size (a physical extent must hold at least one logical extent, e.g. a
blocksize of 1024 byte with two-byte block pointers is not allowed).
Rc stores the number of 128 byte records of the last used logical extent.
Bc stores the number of bytes in the last used record.  The value 0 means
128 for backward compatibility with CP/M 2.2, which did not support Bc.

<P>


<B>Al</B> stores block pointers.  If the disk capacity is less than 256 blocks,
Al is interpreted as 16 byte-values, otherwise as 8 double-byte-values.
A block pointer of 0 marks a hole in the file.  If a hole
covers the range of a full extent, the extent will not be allocated.  In particular,
the first extent of a file does not neccessarily have extent number 0.
A file may not share blocks with other files, as its blocks would be freed
if the other files is erased without a following disk system reset.  CP/M returns
EOF when it reaches a hole, whereas UNIX returns zero-value bytes, which makes
holes invisible.


<A NAME="lbAH">&nbsp;</A>
<H3>Time stamps P2DOS and CP/M Plus support time stamps, which are stored in each fourth</H3>

directory entry.  This entry contains the time stamps for
the extents using the previous three directory entries.  Note that you
really have time stamps for each extent, no matter if it is the first
extent of a file or not.  The structure of time stamp entries is:
<DL COMPACT><DT><DD>
<P>
1 byte status 0x21
<BR>

8 bytes time stamp for third-last directory entry
<BR>

2 bytes unused
<BR>

8 bytes time stamp for second-last directory entry
<BR>

2 bytes unused
<BR>

8 bytes time stamp for last directory entry
<P>
</DL>

A time stamp consists of two dates: Creation and modification date (the
latter being recorded when the file is closed).  CP/M Plus further
allows optionally to record the access instead of creation date as first
time stamp.
<DL COMPACT><DT><DD>
<P>
2 bytes (little-endian) days starting with 1 at 01-01-1978
<BR>

1 byte hour in BCD format
<BR>

1 byte minute in BCD format
<P>
</DL>


<A NAME="lbAI">&nbsp;</A>
<H3>Disc labels CP/M Plus support disc labels, which are stored in an arbitrary directory</H3>

entry.
The structure of disc labels is:
<DL COMPACT><DT><DD>
<P>
1 byte status 0x20
<BR>

<B>F0-E2</B> are the disc label
<BR>

1 byte mode: bit 7 activates password protection, bit 6 causes time stamps on
access, but 5 causes time stamps on modifications, bit 4 causes time stamps on
creation and bit 0 is set when a label exists.  Bit 4 and 6 are exclusively set.
<BR>

1 byte password decode byte: To decode the password, xor this byte with the password
bytes in reverse order.  To encode a password, add its characters to get the
decode byte.
<BR>

2 reserved bytes
<BR>

8 password bytes
<BR>

4 bytes label creation time stamp
<BR>

4 bytes label modification time stamp
<P>
</DL>


<A NAME="lbAJ">&nbsp;</A>
<H3>Passwords CP/M Plus supports passwords, which are stored in an arbitrary directory</H3>

entry.
The structure of these entries is:
<DL COMPACT><DT><DD>
<P>
1 byte status (user number plus 16)
<BR>

<B>F0-E2</B> are the file name and its extension.
<BR>

1 byte password mode: bit 7 means password required for reading, bit 6 for writing
and bit 5 for deleting.
<BR>

1 byte password decode byte: To decode the password, xor this byte with the password
bytes in reverse order.  To encode a password, add its characters to get the
decode byte.
<BR>

2 reserved bytes
<BR>

8 password bytes
<P>
</DL>



<A NAME="lbAK">&nbsp;</A>
<H2>SEE ALSO <I><A HREF="../man1/mkfs.cpm.1.html">mkfs.cpm</A></I>(1),

</H2>

<I><A HREF="../man1/fsck.cpm.1.html">fsck.cpm</A></I>(1),

<I><A HREF="../man1/fsed.cpm.1.html">fsed.cpm</A></I>(1),

<I><A HREF="../man1/cpmls.1.html">cpmls</A></I>(1)


<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME cpm - CP/M disk and file system format</A><DD>
<DL>
<DT><A HREF="#lbAD">Characteristic sizes Each CP/M disk format is described by the following specific sizes:</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION <A NAME="lbAD">&nbsp;</A>
<H3>Characteristic sizes Each CP/M disk format is described by the following specific sizes:</H3>

</A><DD>
<DT><A HREF="#lbAE">Characteristic sizes Each CP/M disk format is described by the following specific sizes:</A><DD>
<DT><A HREF="#lbAF">Device areas A CP/M disk contains three areas:</A><DD>
<DT><A HREF="#lbAG">Directory entries The directory is a sequence of directory entries (also called extents),</A><DD>
<DT><A HREF="#lbAH">Time stamps P2DOS and CP/M Plus support time stamps, which are stored in each fourth</A><DD>
<DT><A HREF="#lbAI">Disc labels CP/M Plus support disc labels, which are stored in an arbitrary directory</A><DD>
<DT><A HREF="#lbAJ">Passwords CP/M Plus supports passwords, which are stored in an arbitrary directory</A><DD>
</DL>
<DT><A HREF="#lbAK">SEE ALSO <I>mkfs.cpm</I>(1),

</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 03:25:14 GMT, November 28, 2008
</BODY>
</HTML>
